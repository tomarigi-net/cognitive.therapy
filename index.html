<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ã‚³ãƒ­ã®æ•´ç† - CBTã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .distortion-tag {
            background-color: #fee2e2;
            color: #ef4444;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            margin: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <div class="max-w-2xl mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-slate-800">ã‚³ã‚³ãƒ­ã®æ•´ç†</h1>
            <p class="text-slate-500 mt-2">èªçŸ¥è¡Œå‹•ç™‚æ³•ï¼ˆCBTï¼‰ã«åŸºã¥ã„ãŸAIã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼</p>
        </header>

        <div id="input-section" class="bg-white rounded-2xl shadow-sm p-6 border border-slate-200">
            <label class="block text-lg font-medium text-slate-700 mb-2">ä»Šã€é ­ã«æµ®ã‹ã‚“ã§ã„ã‚‹ã“ã¨ã¯ï¼Ÿ</label>
            <textarea id="user-thought" class="w-full h-40 p-4 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition" placeholder="ä¾‹ï¼šä»•äº‹ã§ãƒŸã‚¹ã‚’ã—ã¦ã—ã¾ã£ãŸã€‚ã¿ã‚“ãªã«ç„¡èƒ½ã ã¨æ€ã‚ã‚Œã¦ã„ã‚‹ã«é•ã„ãªã„ã€‚"></textarea>
            <button onclick="analyzeThought()" id="submit-btn" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition shadow-lg shadow-blue-200">
                AIã«ç›¸è«‡ã™ã‚‹
            </button>
        </div>

        <div id="loading" class="hidden text-center py-10">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"></div>
            <p class="mt-4 text-slate-600">ã‚ãªãŸã®å¿ƒã‚’åˆ†æä¸­...</p>
        </div>

        <div id="result-section" class="hidden space-y-6 mt-8">
            <div class="bg-white rounded-2xl shadow-sm p-6 border border-slate-200">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">è¦‹ã¤ã‹ã£ãŸèªçŸ¥ã®æ­ªã¿</h3>
                <div id="distortion-list" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="bg-blue-50 rounded-2xl p-6 border border-blue-100">
                <h3 class="text-sm font-bold text-blue-500 uppercase tracking-widest mb-3">æ–°ã—ã„è¦–ç‚¹ï¼ˆåè«–ï¼‰</h3>
                <p id="refutation-text" class="text-slate-700 leading-relaxed text-lg"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="bg-green-50 rounded-xl p-4 border border-green-100">
                    <h3 class="font-bold text-green-700 mb-2">ğŸ’¡ ã“ã®è€ƒãˆæ–¹ã®ãƒ¡ãƒªãƒƒãƒˆ</h3>
                    <p id="benefit-text" class="text-slate-600"></p>
                </div>
                <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
                    <h3 class="font-bold text-purple-700 mb-2">ğŸš€ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                    <ul id="action-list" class="list-disc list-inside text-slate-600 space-y-1"></ul>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full py-3 text-slate-400 hover:text-slate-600 transition text-sm">
                ã‚‚ã†ä¸€åº¦ç›¸è«‡ã™ã‚‹
            </button>
        </div>
    </div>

    <script>
        async function analyzeThought() {
            const thought = document.getElementById('user-thought').value;
            if (!thought) return alert('ä»Šã®æ°—æŒã¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            // è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch('https://cognitive-therapy.onrender.com/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ thought: thought })
                });

                if (!response.ok) throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                
                const data = await response.json();
                displayResults(data);

            } catch (error) {
                alert(error.message);
                document.getElementById('input-section').classList.remove('hidden');
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function displayResults(data) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');

            // 1. èªçŸ¥ã®æ­ªã¿ã‚’ã‚¿ã‚°ã¨ã—ã¦è¡¨ç¤º
            const distList = document.getElementById('distortion-list');
            distList.innerHTML = '';
            data.distortions.forEach(d => {
                const span = document.createElement('span');
                span.className = 'distortion-tag';
                span.innerText = d;
                distList.appendChild(span);
            });

            // 2. åè«–ã‚’è¡¨ç¤º
            document.getElementById('refutation-text').innerText = data.refutation;

            // 3. ãƒ¡ãƒªãƒƒãƒˆã‚’è¡¨ç¤º
            document.getElementById('benefit-text').innerText = data.benefit;

            // 4. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            const actionList = document.getElementById('action-list');
            actionList.innerHTML = '';
            data.actions.forEach(a => {
                const li = document.createElement('li');
                li.innerText = a;
                actionList.appendChild(li);
            });
        }
    </script>
</body>
</html>