<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint CBT - AI Partner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --mint-primary: #f0fff4; --mint-dark: #3e8e7e; --mint-accent: #10b981; }
        body { background-color: #f7fafc; color: #334155; }
        .mint-bg { background-color: var(--mint-primary); }
        .step-card { display: none; animation: fadeIn 0.5s ease forwards; }
        .step-card.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .distortion-chip { transition: all 0.3s; border: 1px solid #e2e8f0; font-size: 0.75rem; padding: 0.5rem; border-radius: 0.5rem; background: white; }
        .highlight { border-color: var(--mint-accent); background-color: #ecfdf5; color: var(--mint-dark); font-weight: bold; transform: scale(1.03); }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-2xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-teal-800 tracking-tight">Mint CBT</h1>
            <p class="text-teal-600/70 text-sm">AIã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ãŒã€ã‚ãªãŸã®å¿ƒã«å¯„ã‚Šæ·»ã„ã¾ã™</p>
        </header>

        <div id="step-1" class="step-card active bg-white p-8 rounded-3xl shadow-sm border border-emerald-100">
            <div class="mb-6">
                <label class="block font-bold text-teal-900 mb-2">ä»Šã®çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„</label>
                <textarea id="thought" class="w-full mint-bg border-emerald-100 rounded-2xl p-4 h-32 focus:ring-2 focus:ring-emerald-400 outline-none transition" placeholder="ä¾‹ï¼šä»•äº‹ã®ãƒŸã‚¹ã‚’æŒ‡æ‘˜ã•ã‚ŒãŸã€‚ã¿ã‚“ãªç§ã‚’ç„¡èƒ½ã ã¨æ€ã£ã¦ã„ã‚‹æ°—ãŒã™ã‚‹..."></textarea>
            </div>
            <div class="mb-8">
                <label class="block font-bold text-teal-900 mb-2">ä»Šã®è‹¦ã—ã•ã¯ï¼Ÿ (0-100)</label>
                <input type="range" id="before-score" class="w-full h-2 bg-emerald-100 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                <div class="text-center font-bold text-emerald-600 mt-2"><span id="before-val">50</span>%</div>
            </div>
            <button onclick="goToStep(2)" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-2xl shadow-lg transition shadow-emerald-200">
                AIã«ç›¸è«‡ã™ã‚‹
            </button>
        </div>

        <div id="step-2" class="step-card bg-white p-8 rounded-3xl shadow-sm border border-emerald-100 text-center">
            <h2 class="text-xl font-bold text-teal-900 mb-4">åˆ†æã®çµæœã€ã“ã‚“ãªã€Œãã›ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</h2>
            <div id="distortion-grid" class="grid grid-cols-2 gap-2 mb-8 text-left">
                <div id="d-1" class="distortion-chip">ç™½é»’æ€è€ƒ</div>
                <div id="d-2" class="distortion-chip">ä¸€èˆ¬åŒ–ã®ã—ã™ã</div>
                <div id="d-3" class="distortion-chip">å¿ƒã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
                <div id="d-4" class="distortion-chip">ãƒã‚¤ãƒŠã‚¹æ€è€ƒåŒ–</div>
                <div id="d-5" class="distortion-chip">çµè«–ã®é£›èº</div>
                <div id="d-6" class="distortion-chip">æ‹¡å¤§è§£é‡ˆãƒ»éå°è©•ä¾¡</div>
                <div id="d-7" class="distortion-chip">æ„Ÿæƒ…çš„æ±ºã‚ã¤ã‘</div>
                <div id="d-8" class="distortion-chip">ã™ã¹ãæ€è€ƒ</div>
                <div id="d-9" class="distortion-chip">ãƒ¬ãƒƒãƒ†ãƒ«è²¼ã‚Š</div>
                <div id="d-10" class="distortion-chip">å€‹äººåŒ–</div>
            </div>
            <button onclick="goToStep(3)" class="w-full bg-slate-800 hover:bg-black text-white font-bold py-4 rounded-2xl transition">
                ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’èª­ã‚€
            </button>
        </div>

        <div id="step-3" class="step-card space-y-4">
            <div class="mint-bg p-6 rounded-3xl border border-emerald-200">
                <h3 class="font-bold text-teal-900 mb-2 flex items-center">ğŸŒ¿ è¦–ç‚¹ã‚’å¤‰ãˆã¦ã¿ã¾ã—ã‚‡ã†</h3>
                <p id="refutation-text" class="text-slate-700 text-sm leading-relaxed"></p>
            </div>
            <div class="bg-blue-50 p-6 rounded-3xl border border-blue-100">
                <h3 class="font-bold text-blue-900 mb-2 flex items-center">âœ¨ å¿ƒã®å¤‰åŒ–</h3>
                <p id="benefit-text" class="text-slate-700 text-sm leading-relaxed"></p>
            </div>
            <div class="bg-amber-50 p-6 rounded-3xl border border-amber-100">
                <h3 class="font-bold text-amber-900 mb-2 flex items-center">ğŸƒâ€â™‚ï¸ ä»Šæ—¥ã®ä¸€æ­©</h3>
                <ul id="action-list" class="text-slate-700 text-sm space-y-2 list-disc ml-5 mt-2"></ul>
            </div>
            <button onclick="goToStep(4)" class="w-full bg-emerald-500 text-white font-bold py-4 rounded-2xl shadow-lg">
                ä»Šã®æ°—æŒã¡ã‚’ç¢ºèªã™ã‚‹
            </button>
        </div>

        <div id="step-4" class="step-card bg-white p-8 rounded-3xl shadow-sm border border-emerald-100 text-center">
            <h2 class="text-xl font-bold text-teal-900 mb-4">ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ä»Šã®æ°—åˆ†ã¯ã©ã†ã§ã™ã‹ï¼Ÿ</h2>
            <input type="range" id="after-score" class="w-full h-2 bg-emerald-100 rounded-lg appearance-none cursor-pointer accent-emerald-500">
            <div class="text-center font-bold text-emerald-600 mt-2 mb-8"><span id="after-val">50</span>%</div>
            
            <div id="result-message" class="p-4 bg-emerald-50 rounded-xl text-emerald-800 font-bold mb-6"></div>
            
            <button onclick="location.reload()" class="text-emerald-600 font-bold hover:underline">
                ã‚‚ã†ä¸€åº¦ã€åˆ¥ã®ã“ã¨ã‚’è¨˜éŒ²ã™ã‚‹
            </button>
        </div>
    </div>

    <script>
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼é€£å‹•
        document.getElementById('before-score').oninput = function() { document.getElementById('before-val').innerText = this.value; }
        document.getElementById('after-score').oninput = function() { 
            document.getElementById('after-val').innerText = this.value;
            const diff = document.getElementById('before-score').value - this.value;
            const msg = diff > 0 ? `${diff}%ã‚‚å¿ƒãŒè»½ããªã‚Šã¾ã—ãŸã­ï¼` : "å°‘ã—ãšã¤ã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§å¤§ä¸ˆå¤«ã§ã™ã‚ˆã€‚";
            document.getElementById('result-message').innerText = msg;
        }

        function goToStep(step) {
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
            document.getElementById('step-' + step).classList.add('active');
            
            if(step === 2) simulateAIAnalysis();
        }

        function simulateAIAnalysis() {
            async function analyzeThought() {
    const thoughtText = document.getElementById('thought').value;
    if (!thoughtText) return alert("ã¾ãšã¯æ°—æŒã¡ã‚’æ›¸ãå‡ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚");

    document.getElementById('prescription').classList.add('hidden');
    document.getElementById('ai-loading').classList.remove('hidden');

    try {
        // Pythonã‚µãƒ¼ãƒãƒ¼(Flask)ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹
        const response = await fetch('http://localhost:5000/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ thought: thoughtText })
        });

        const data = await response.json();

        // 1. èªçŸ¥ã®æ­ªã¿ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
        const chips = document.querySelectorAll('.distortion-chip');
        chips.forEach(c => c.classList.remove('highlight', 'dimmed'));
        
        // 10ã®ãƒªã‚¹ãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’å…‰ã‚‰ã›ã‚‹
        chips.forEach(chip => {
            const name = chip.innerText.split('. ')[1] || chip.innerText;
            if (data.distortions.includes(name)) {
                chip.classList.add('highlight');
            } else {
                chip.classList.add('dimmed');
            }
        });

        // 2. ãƒ†ã‚­ã‚¹ãƒˆã‚’æµã—è¾¼ã‚€
        document.getElementById('refutation-text').innerText = data.refutation;
        document.getElementById('benefit-text').innerText = data.benefit;
        
        const actionList = document.getElementById('action-list');
        actionList.innerHTML = data.actions.map(a => `<li>${a}</li>`).join('');

        // ç”»é¢é·ç§»
        document.getElementById('ai-loading').classList.add('hidden');
        document.getElementById('prescription').classList.remove('hidden');
        document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
        document.getElementById('step-3').classList.add('active');

    } catch (error) {
        alert("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Pythonãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }
}
        }
    </script>
</body>
</html>